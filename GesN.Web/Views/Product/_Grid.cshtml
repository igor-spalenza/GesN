@model IEnumerable<GesN.Web.Models.ViewModels.Production.ProductViewModel>

<div class="table-responsive">
    <table class="table table-hover table-striped" id="productsTable">
        <thead class="table-dark">
            <tr>
                <th>Código</th>
                <th>Nome</th>
                <th>Tipo</th>
                <th>Categoria</th>
                <th>Preço</th>
                <th>Estoque</th>
                <th>Status</th>
                <th width="120px">Ações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model)
            {
                <tr>
                    <td>
                        <code class="text-primary">@product.Code</code>
                    </td>
                    <td>
                        <div>
                            <strong>@product.Name</strong>
                            @if (!string.IsNullOrEmpty(product.Description))
                            {
                                <br><small class="text-muted">@product.Description</small>
                            }
                        </div>
                    </td>
                    <td>
                        @{
                            var typeClass = product.ProductType switch
                            {
                                ProductType.Simple => "badge-primary",
                                ProductType.Composite => "badge-info", 
                                ProductType.Group => "badge-success",
                                _ => "badge-secondary"
                            };
                        }
                        <span class="badge @typeClass">@product.ProductTypeDisplay</span>
                    </td>
                    <td>
                        @if (!string.IsNullOrEmpty(product.CategoryName))
                        {
                            <span class="badge bg-light text-dark">@product.CategoryName</span>
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </td>
                    <td>
                        @if (product.Price.HasValue)
                        {
                            <span class="fw-bold text-success">@product.PriceDisplay</span>
                        }
                        else
                        {
                            <span class="text-muted">N/A</span>
                        }
                    </td>
                    <td>
                        @if (product.CurrentStock.HasValue)
                        {
                            @if (product.MinStock.HasValue && product.CurrentStock <= product.MinStock)
                            {
                                <span class="badge bg-danger">
                                    <i class="fas fa-exclamation-triangle"></i> @product.StockDisplay
                                </span>
                            }
                            else if (product.MinStock.HasValue && product.CurrentStock <= (product.MinStock * 1.2))
                            {
                                <span class="badge bg-warning">
                                    <i class="fas fa-exclamation"></i> @product.StockDisplay
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-success">@product.StockDisplay</span>
                            }
                            
                            @if (!string.IsNullOrEmpty(product.Unit))
                            {
                                <small class="text-muted">@product.Unit</small>
                            }
                        }
                        else
                        {
                            <span class="text-muted">N/A</span>
                        }
                    </td>
                    <td>
                        @if (product.StateCode == 1)
                        {
                            <span class="badge bg-success">Ativo</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">Inativo</span>
                        }
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="productManager.verDetalhes('@product.Id')" 
                                    title="Ver Detalhes">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-warning" 
                                    onclick="productManager.editarProduct('@product.Id')" 
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            @if (product.ProductType == ProductType.Composite)
                            {
                                <button type="button" class="btn btn-sm btn-outline-info" 
                                        onclick="productManager.gerenciarComponentes('@product.Id')" 
                                        title="Gerenciar Componentes">
                                    <i class="fas fa-cogs"></i>
                                </button>
                            }
                            @if (product.ProductType == ProductType.Group)
                            {
                                <button type="button" class="btn btn-sm btn-outline-secondary" 
                                        onclick="productManager.gerenciarGrupo('@product.Id')" 
                                        title="Gerenciar Grupo">
                                    <i class="fas fa-layer-group"></i>
                                </button>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (!Model.Any())
{
    <div class="text-center py-5">
        <i class="fas fa-boxes fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">Nenhum produto encontrado</h5>
        <p class="text-muted">Clique no botão "Novo Produto" para criar o primeiro produto.</p>
        <button type="button" class="btn btn-primary" onclick="productManager.novoProduct()">
            <i class="fas fa-plus"></i> Criar Primeiro Produto
        </button>
    </div>
} 