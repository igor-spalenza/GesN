@using GesN.Web.Models.ViewModels.Production
@model ProductDetailsViewModel

<div class="container-fluid">
    <!-- Informações Básicas -->
    <div class="card">
        <div class="card-header">
            <h6 class="card-title mb-0">
                <i class="fas fa-box"></i> Informações Básicas
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Código:</dt>
                        <dd class="col-sm-8"><code class="text-primary">@Model.Code</code></dd>
                        
                        <dt class="col-sm-4">Nome:</dt>
                        <dd class="col-sm-8"><strong>@Model.Name</strong></dd>
                        
                        <dt class="col-sm-4">Tipo:</dt>
                        <dd class="col-sm-8">
                            @switch (Model.ProductType)
                            {
                                case ProductType.Simple:
                                    <span class="badge bg-info">@Model.ProductTypeDisplay</span>
                                    break;
                                case ProductType.Composite:
                                    <span class="badge bg-warning">@Model.ProductTypeDisplay</span>
                                    break;
                                case ProductType.Group:
                                    <span class="badge bg-secondary">@Model.ProductTypeDisplay</span>
                                    break;
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Categoria:</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.CategoryName))
                            {
                                <span class="badge bg-light text-dark">@Model.CategoryName</span>
                            }
                            else
                            {
                                <span class="text-muted">Não informada</span>
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Status:</dt>
                        <dd class="col-sm-8">
                            @if (Model.StateCode == 1)
                            {
                                <span class="badge bg-success">Ativo</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Inativo</span>
                            }
                        </dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Preço:</dt>
                        <dd class="col-sm-8">
                            @if (Model.Price.HasValue)
                            {
                                <span class="fw-bold text-success">@Model.PriceDisplay</span>
                            }
                            else
                            {
                                <span class="text-muted">Não informado</span>
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Custo:</dt>
                        <dd class="col-sm-8">
                            @if (Model.Cost.HasValue)
                            {
                                <span class="text-warning">@Model.CostDisplay</span>
                            }
                            else
                            {
                                <span class="text-muted">Não informado</span>
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Unidade:</dt>
                        <dd class="col-sm-8">@(Model.Unit ?? "Não informada")</dd>
                        
                        <dt class="col-sm-4">Estoque Atual:</dt>
                        <dd class="col-sm-8">
                            @if (Model.CurrentStock.HasValue)
                            {
                                @if (Model.MinStock.HasValue && Model.CurrentStock <= Model.MinStock)
                                {
                                    <span class="badge bg-danger">
                                        <i class="fas fa-exclamation-triangle"></i> @Model.StockDisplay
                                    </span>
                                }
                                else if (Model.MinStock.HasValue && Model.CurrentStock <= (Model.MinStock * 1.2))
                                {
                                    <span class="badge bg-warning">
                                        <i class="fas fa-exclamation"></i> @Model.StockDisplay
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-success">@Model.StockDisplay</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">Não controlado</span>
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Estoque Mínimo:</dt>
                        <dd class="col-sm-8">@(Model.MinStock?.ToString() ?? "Não definido")</dd>
                    </dl>
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="row mt-3">
                    <div class="col-12">
                        <dt>Descrição:</dt>
                        <dd class="mt-1">@Model.Description</dd>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Informações Específicas por Tipo -->
    @if (Model.ProductType == ProductType.Composite)
    {
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-cogs"></i> Informações de Produto Composto
                </h6>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Tempo de Montagem:</dt>
                    <dd class="col-sm-9">
                        @if (Model.AssemblyTime.HasValue)
                        {
                            <span class="badge bg-info">@Model.AssemblyTimeDisplay</span>
                        }
                        else
                        {
                            <span class="text-muted">Não definido</span>
                        }
                    </dd>
                </dl>
                
                <div class="mt-3">
                    <button type="button" class="btn btn-outline-info btn-sm" 
                            onclick="productManager.gerenciarComponentes('@Model.Id')">
                        <i class="fas fa-cogs"></i> Gerenciar Componentes
                    </button>
                </div>
            </div>
        </div>
    }

    @if (Model.ProductType == ProductType.Group)
    {
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-layer-group"></i> Informações de Grupo de Produtos
                </h6>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Min. Itens Obrigatórios:</dt>
                    <dd class="col-sm-3">
                        @if (Model.MinItemsRequired.HasValue)
                        {
                            <span class="badge bg-info">@Model.MinItemsRequired</span>
                        }
                        else
                        {
                            <span class="text-muted">Não definido</span>
                        }
                    </dd>
                    
                    <dt class="col-sm-3">Max. Itens Permitidos:</dt>
                    <dd class="col-sm-3">
                        @if (Model.MaxItemsAllowed.HasValue)
                        {
                            <span class="badge bg-warning">@Model.MaxItemsAllowed</span>
                        }
                        else
                        {
                            <span class="text-muted">Ilimitado</span>
                        }
                    </dd>
                </dl>
                
                <div class="mt-3">
                    <button type="button" class="btn btn-outline-secondary btn-sm" 
                            onclick="productManager.gerenciarGrupo('@Model.Id')">
                        <i class="fas fa-layer-group"></i> Gerenciar Grupo
                    </button>
                </div>
            </div>
        </div>
    }

    <!-- Informações de Auditoria -->
    <div class="card mt-3">
        <div class="card-header">
            <h6 class="card-title mb-0">
                <i class="fas fa-history"></i> Informações de Auditoria
            </h6>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Data de Criação:</dt>
                <dd class="col-sm-4">@Model.FormattedCreatedAt</dd>
                
                <dt class="col-sm-3">Última Modificação:</dt>
                <dd class="col-sm-2">@Model.FormattedModifiedAt</dd>
            </dl>
        </div>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times"></i> Fechar
    </button>
    <button type="button" class="btn btn-warning" onclick="productManager.editarProduct('@Model.Id')">
        <i class="fas fa-edit"></i> Editar
    </button>
    @if (Model.ProductType == ProductType.Composite)
    {
        <button type="button" class="btn btn-info" onclick="productManager.gerenciarComponentes('@Model.Id')">
            <i class="fas fa-cogs"></i> Componentes
        </button>
    }
    @if (Model.ProductType == ProductType.Group)
    {
        <button type="button" class="btn btn-secondary" onclick="productManager.gerenciarGrupo('@Model.Id')">
            <i class="fas fa-layer-group"></i> Gerenciar Grupo
        </button>
    }
</div> 