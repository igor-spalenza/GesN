@{
    ViewData["Title"] = "Depuração de Roles";
}

<h1>@ViewData["Title"]</h1>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Status da Conexão</h5>
            </div>
            <div class="card-body">
                <a asp-action="ConnectionTest" class="btn btn-primary">Testar Conexão</a>
                
                @if (ViewBag.ConnectionState != null)
                {
                    <div class="alert alert-info mt-3">
                        @ViewBag.ConnectionState
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Verificar Banco de Dados</h5>
            </div>
            <div class="card-body">
                <form asp-action="CheckDatabase" method="post">
                    <button type="submit" class="btn btn-primary">Verificar Banco de Dados</button>
                </form>
                
                @if (ViewBag.DbStatus != null)
                {
                    <div class="alert alert-info mt-3">
                        <p><strong>Status do Banco:</strong> @ViewBag.DbStatus</p>
                        
                        @if (ViewBag.TableStructure != null)
                        {
                            <p><strong>Estrutura da Tabela:</strong> @ViewBag.TableStructure</p>
                        }
                    </div>
                }

                @if (ViewBag.Roles != null)
                {
                    <div class="mt-3">
                        <h6>Roles existentes:</h6>
                        <ul class="list-group">
                            @foreach (var role in ViewBag.Roles)
                            {
                                <li class="list-group-item">
                                    <strong>ID:</strong> @role.Id <br />
                                    <strong>Nome:</strong> @role.Name <br />
                                    <strong>Nome Normalizado:</strong> @role.NormalizedName
                                </li>
                            }
                        </ul>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Criar Role (Teste)</h5>
            </div>
            <div class="card-body">
                <form asp-action="CreateRole" method="post">
                    <div class="form-group">
                        <label for="roleName">Nome da Role</label>
                        <input type="text" class="form-control" id="roleName" name="roleName" required>
                    </div>
                    <button type="submit" class="btn btn-success mt-2">Criar Role</button>
                </form>
                
                @if (ViewBag.SuccessMessage != null)
                {
                    <div class="alert alert-success mt-3">
                        @ViewBag.SuccessMessage
                    </div>
                }
                
                @if (ViewBag.ErrorMessage != null)
                {
                    <div class="alert alert-danger mt-3">
                        @ViewBag.ErrorMessage
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Teste Direto de Criação</h5>
            </div>
            <div class="card-body">
                <a asp-action="TestDirectCreate" class="btn btn-warning">Criar Role de Teste Diretamente</a>
                <p class="mt-2 small text-muted">
                    Este botão cria uma role de teste diretamente no banco de dados 
                    sem passar pelo formulário normal.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <a asp-area="Admin" asp-controller="Roles" asp-action="Index" class="btn btn-secondary">Voltar para Gerenciamento de Roles</a>
    </div>
</div> 